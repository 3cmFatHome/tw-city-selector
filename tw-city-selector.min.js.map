{"version":3,"names":[],"mappings":"","sources":["tw-city-selector.js"],"sourcesContent":["'use strict';\n\n// --------------------\n// Module import\n// --------------------\nimport data from './data';\nimport handleOptions from './handleOptions';\n\n\n// --------------------\n// Module export\n// --------------------\n// module.exports = TwCitySelector; /* use browserify to build */\nexport default TwCitySelector; /* use rollup to build */\n\n\n// --------------------\n// Constructor\n// --------------------\nfunction TwCitySelector() {\n  // --- Setting options ---\n  var optionsCustom = arguments[0];\n  var optionsRequired = arguments.length ? ['el'] : null; // 若無參數則不設必要參數\n  var optionsDefault = {\n    el: null,\n    elCountry: null,\n    elDistrict: null,\n    elZipcode: null,\n    selectedCountry: null, // {boolean} 預設選擇的縣市\n    selectedDistrict: null, //{boolean} 預設選擇的區域\n    only: null, // {array} 限制顯示哪些縣市\n    showZipcode: false, // {boolean} 是否顯示郵遞區號欄位\n    countryClassName: 'country',\n    countryFiledName: 'country',\n    districtClassName: 'district',\n    districtFieldName: 'district',\n    zipcodeClassName: 'zipcode',\n    zipcodeFieldName: 'zipcode'\n  };\n\n  // --- Setting properties ---\n  this.options = handleOptions(optionsCustom, optionsRequired, optionsDefault);\n\n  // 有指定 el 的初始化\n  if (this.options.el) {\n    this.el = getElements(this.options.el);\n    this.elCountry = getElements(this.options.elCountry);\n    this.elDistrict = getElements(this.options.elDistrict);\n    this.elZipcode = getElements(this.options.elZipcode);\n    init.call(this);\n    return this;\n  }\n\n  // 無指定 el，使用符合的 data-role DOM 作為 el\n  var els = document.querySelectorAll('[role=\"tw-city-selector\"]');\n  els.forEach(function(el) {\n    var self = JSON.parse(JSON.stringify(this)); // clone object，因 object 為參考\n\n    // 重置相關各 el 設定\n    self.el = el;\n    self.elCountry = null;\n    self.elDistrict = null;\n    self.elZipcode = null;\n\n    // 限制顯示哪些縣市\n    self.options.only = el.getAttribute('data-only')\n      ? el.getAttribute('data-only').replace(/\\s/g, '').split(',') // 去除空白字元，轉陣列\n      : null;\n\n    // 預設選擇的縣市\n    self.options.selectedCountry = el.getAttribute('data-selected-country');\n\n    // 預設選擇的區域\n    self.options.selectedDistrict = el.getAttribute('data-selected-district');\n\n    // 是否顯示郵遞區號\n    self.options.showZipcode = (el.getAttribute('data-show-zipcode') != null);\n\n    init.call(self);\n  }, this);\n\n  return this;\n};\n\n\n// --------------------\n// Public Methods\n// --------------------\nTwCitySelector.prototype.reset = function() {\n  return resetSelectors.call(this);\n};\n\n\n// --------------------\n// Private Methods\n// --------------------\nfunction init() {\n  setElements.call(this);\n  setCountryChanged.call(this);\n  setDistrictChanged.call(this);\n\n  if (this.options.selectedCountry) {\n    setSelectedItem.call(this);\n  }\n}\n\nfunction getElements(el) {\n  if ( ! el) return null;\n  return document.querySelector(el);\n}\n\nfunction setElements() {\n  // 縣市選單\n  if ( ! this.elCountry) {\n    var country = document.createElement('select');\n    this.elCountry = country;\n    this.el.appendChild(country);\n  }\n\n  this.elCountry.innerHTML = getCountryOptions(this.options.only);\n  this.elCountry.setAttribute('class', this.options.countryClassName);\n  this.elCountry.name = this.options.countryFiledName;\n\n  // 區域選單\n  if ( ! this.elDistrict) {\n    var district = document.createElement('select');\n    this.elDistrict = district;\n    this.el.appendChild(district);\n  }\n\n  this.elDistrict.innerHTML = getDistrictOptions();\n  this.elDistrict.setAttribute('class', this.options.districtClassName);\n  this.elDistrict.name = this.options.districtFieldName;\n\n  // 郵遞區號\n  if ( ! this.elZipcode) {\n    var zipcode = document.createElement('input');\n    this.elZipcode = zipcode;\n    this.el.appendChild(zipcode);\n  }\n\n  this.elZipcode.setAttribute('class', this.options.zipcodeClassName);\n  this.elZipcode.name = this.options.zipcodeFieldName;\n  this.elZipcode.type = 'text';\n  this.elZipcode.readOnly = true;\n  this.elZipcode.autocomplete = \"off\";\n  this.elZipcode.placeholder = \"郵遞區號\";\n  this.elZipcode.style.width = '6em';\n  this.elZipcode.style.display = this.options.showZipcode || 'none';\n}\n\nfunction getCountryOptions(only) {\n  var options = '<option value=\"\">選擇縣市</option>';\n\n  for (var i = 0, j = data.country.length; i < j; i++) {\n    // 若有設定限制顯示的縣市，且該項目不在自訂縣市中\n    if (only && Array.isArray(only) && only.indexOf(data.country[i]) === -1) {\n      continue;\n    }\n\n    // format: <option value=\"台北市\" data-index=\"0\">台北市</option>\n    options += `<option value=\"${data.country[i]}\" data-index=\"${i}\">${data.country[i]}</option>`;\n  }\n\n  return options;\n}\n\nfunction getDistrictOptions(index) {\n  if ( ! index) {\n    return '<option value=\"\" selected>---</option>';\n  }\n\n  var options = '<option value=\"\" selected>選擇區域</option>';\n\n  for(var i = 0, j = data.district[index][0].length - 1; i <= j; i++) {\n    // format: <option value=\"中正區\" data-zipcode=\"100\">中正區</option>\n    options += `\n      <option value=\"${data.district[index][0][i]}\" data-zipcode=\"${data.district[index][1][i]}\">\n        ${data.district[index][0][i]}\n      </option>\n    `;\n  }\n\n  return options;\n}\n\nfunction setCountryChanged() {\n  var handler = function() {\n    var index = this.elCountry.querySelector('option:checked')\n      .getAttribute('data-index'); // 取 dada-index\n    this.elDistrict.innerHTML = getDistrictOptions(index);\n    this.elZipcode.value = '';\n  }.bind(this);\n\n  this.elCountry.addEventListener('change', handler);\n}\n\nfunction setDistrictChanged() {\n  var handler = function() {\n    var zipcode = this.elDistrict.querySelector('option:checked')\n      .getAttribute('data-zipcode'); // 取 dada-zipcode\n    this.elZipcode.value = zipcode;\n  }.bind(this);\n\n  this.elDistrict.addEventListener('change', handler);\n}\n\nfunction setSelectedItem() {\n  var event = document.createEvent('Event');\n  event.initEvent('change', true, true);\n\n  this.elCountry.value = this.options.selectedCountry;\n  this.elCountry.dispatchEvent(event);\n\n  if (this.options.selectedDistrict) {\n    this.elDistrict.value = this.options.selectedDistrict;\n    this.elDistrict.dispatchEvent(event);\n  }\n}\n\nfunction resetSelectors() {\n  this.elCountry.selectedIndex = 0;\n  this.elDistrict.innerHTML = getDistrictOptions();\n  this.elZipcode.value = '';\n  return this;\n}\n"],"file":"tw-city-selector.min.js"}